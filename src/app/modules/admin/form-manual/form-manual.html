<div class="form-overlay">
  <div class="form-container">
    <header>
      <h2>{{ appointmentId ? 'Editar Cita' : 'Nueva Cita Manual' }}</h2>
      <button class="btn-close" (click)="close.emit()">×</button>
    </header>

    <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">

      <section class="form-grid">

        <div class="field">
          <label>Cliente</label>
          <select formControlName="idCliente">
            <option [ngValue]="null">Seleccione Cliente...</option>
            <option *ngFor="let c of clientes" [ngValue]="c.idClientes">
              {{ c.nombreCliente }}
            </option>
          </select>
        </div>

        <div class="field">
          <label>Mascota</label>
          <select formControlName="idMascota">
            <option [ngValue]="null">Seleccione Mascota...</option>
            <option *ngFor="let m of mascotas" [ngValue]="m.idMascota">
              {{ m.nombreMascota }}
            </option>
          </select>
        </div>

      </section>

      <section class="form-grid">
        <div class="field">
          <label>Veterinario</label>
          <select formControlName="userIdUser">
            <option [ngValue]="null">Seleccione Doctor...</option>
            <option *ngFor="let vet of veterinarians" [ngValue]="vet.id">
              {{ vet.name }}
            </option>
          </select>
        </div>
        
        <div class="field">
          <label>Servicio</label>
          <select formControlName="idServicio">
            <option [ngValue]="null">Seleccione Servicio...</option>
            <option *ngFor="let s of services" [ngValue]="s.idServicio">
              {{ s.nombreServicio }}
            </option>
          </select>
        </div>
      </section>

      <section class="form-grid">
        <div class="field">
          <label>Fecha</label>
          <input type="date" formControlName="fecha">
        </div>
        <div class="field">
          <label>Hora Inicio</label>
          <input type="time" formControlName="hora">
        </div>
      </section>

      <section class="form-grid">
        <div class="field">
          <label>Estado Cita</label>
          <select formControlName="estadoCita">
            <!-- ✅ CORRECCIÓN: value en minúsculas, display con capitalize -->
            <option *ngFor="let status of appointmentStatuses" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>
        </div>
      </section>

      <div class="field full-width">
        <label>Motivo de Visita</label>
        <textarea formControlName="motivo" rows="3" placeholder="Descripción breve..."></textarea>
      </div>

      <footer class="form-actions">
        <button type="button" (click)="close.emit()" class="btn-cancel">Cancelar</button>
        <button type="submit" class="btn-save">
          {{ appointmentId ? 'Guardar Cambios' : 'Confirmar Cita' }}
        </button>
      </footer>
    </form>
    
  </div>
</div>